# URDF: Унифицированное описание робота

## Содержание

- [Содержание](#содержание)
- [Зачем нужен URDF?](#зачем-нужен-urdf)
- [Основы формата URDF](#основы-формата-urdf)
  - [Обязательные компоненты](#обязательные-компоненты)
  - [Элемент `<link>`: описание звена](#элемент-link-описание-звена)
  - [Элемент `<joint>`: соединения между звеньями](#элемент-joint-соединения-между-звеньями)
- [Создаем URDF для манипулятора](#создаем-urdf-для-манипулятора)
- [Что нужно сделать?](#что-нужно-сделать)
- [Вопросики](#вопросики)
- [С чем познакомились?](#с-чем-познакомились)
- [Полезные ресурсы](#полезные-ресурсы)

---

## Зачем нужен URDF?

Чтобы описать структуру робота (например, манипулятор или мобильную платформу), мы используем **Unified Robot Description Format (URDF)**. Это стандарт, основанный на XML, который позволяет описывать геометрию, инерцию, визуальные свойства и соединения частей робота. 

Пример возможностей URDF:
- Определение структуры робота: звенья (links) и соединения (joints).
- Описание физических свойств звеньев: масса, моменты инерции.
- Определение визуальных моделей и моделей столкновений.
- Упрощение интеграции робота в симуляцию и планировщики движений.

Документация доступна на [wiki.ros.org](https://wiki.ros.org/urdf/XML).

---

## Основы формата URDF

URDF основан на XML и имеет строгую структуру. Рассмотрим пример:

```xml
<?xml version="1.0"?>
<robot name="example_robot">
    <link name="base_link">
        <visual>
            <geometry>
                <box size="1 1 1"/>
            </geometry>
            <material name="blue">
                <color rgba="0 0 1 1"/>
            </material>
        </visual>
    </link>
</robot>
```

Этот файл описывает робота с единственным звеном `base_link`. Давайте разберем его компоненты.

---

### Обязательные компоненты

1. **`<?xml version="1.0"?>`**  
   Указывает, что файл использует XML. Это похоже на шебанг в скриптах Python:
   ```python
   #!/usr/bin/env python
   ```

2. **`<robot>`**  
   Корневой элемент URDF, который задает имя робота. Все остальные элементы вложены в `<robot>`.

3. **`<link>`**  
   Элемент, описывающий звено робота, его геометрию, физические свойства и свойства столкновений.

4. **`<joint>`**  
   Элемент, который связывает два звена и задает их относительное движение.

---

### Элемент `<link>`: описание звена

Элемент `<link>` описывает звено робота, включая его визуальные характеристики, инерцию и свойства столкновений. Пример:

```xml
<link name="base_link">
    <visual>
        <origin xyz="0 0 0"/>
        <geometry>
            <box size="1 1 1"/>
        </geometry>
        <material name="blue">
            <color rgba="0 0 1 1"/>
        </material>
    </visual>
    <collision>
        <geometry>
            <box size="1 1 1"/>
        </geometry>
    </collision>
    <inertial>
        <origin xyz="0 0 0.5"/>
        <mass value="1.0"/>
        <inertia ixx="0.1" iyy="0.1" izz="0.1"/>
    </inertial>
</link>
```

- **`<visual>`**: Визуальная модель звена для отображения в Rviz.
  - **`<geometry>`**: Форма звена (`box`, `cylinder`, `sphere` или `mesh`).
  - **`<material>`**: Цвет или текстура звена.
- **`<collision>`**: Модель звена для проверки столкновений.
  - **`<geometry>`**: Форма звена (может отличаться от визуальной модели).
- **`<inertial>`**: Физические свойства звена:
  - **`<mass>`**: Масса звена.
  - **`<inertia>`**: Моменты инерции вокруг центра масс.
  - **`<origin>`**: Смещение центра масс.

---

### Элемент `<joint>`: соединения между звеньями

Элемент `<joint>` задает связь между двумя звеньями. Пример:

```xml
<joint name="joint1" type="revolute">
    <parent link="base_link"/>
    <child link="link1"/>
    <origin xyz="0 0 1"/>
    <axis xyz="0 0 1"/>
    <limit effort="10" velocity="1.0" lower="0" upper="1.57"/>
</joint>
```

- **`type`**: Тип соединения:
  - `fixed`: Жесткая связь (без движения).
  - `revolute`: Вращательное соединение вокруг оси.
  - `prismatic`: Линейное движение вдоль оси.
- **`<parent>` и `<child>`**: Указывают звенья, которые соединяются.
- **`<origin>`**: Положение соединения относительно родительского звена.
- **`<axis>`**: Ось вращения или линейного движения.
- **`<limit>`**: Ограничения усилия, скорости и диапазона движения.

---

## Создаем URDF для манипулятора

Теперь создадим URDF для простого манипулятора с двумя звеньями. Вот пример:

```xml
<robot name="simple_arm" xmlns:xacro="http://wiki.ros.org/xacro">
    <link name="base_link">
        <visual>
            <geometry>
                <cylinder radius="0.1" length="0.2"/>
            </geometry>
            <material name="gray">
                <color rgba="0.5 0.5 0.5 1"/>
            </material>
        </visual>
    </link>
    <joint name="joint1" type="revolute">
        <parent link="base_link"/>
        <child link="link1"/>
        <origin xyz="0 0 0.1"/>
        <axis xyz="0 0 1"/>
        <limit effort="5" velocity="2.0" lower="0" upper="3.14"/>
    </joint>
    <link name="link1">
        <visual>
            <geometry>
                <box size="0.1 0.1 0.5"/>
            </geometry>
            <material name="blue">
                <color rgba="0 0 1 1"/>
            </material>
        </visual>
    </link>
</robot>
```

Этот робот состоит из:
- Базового звена `base_link` (цилиндр).
- Подвижного звена `link1` (параллелепипед).
- Вращательного соединения `joint1`.

> Создайте в вашем пакете папку `urdf` и файле `example.urdf` поместите содержимое файла выше.

> Создайте в папке `launch` вашего пакета launch-файл со следующим содержимым

```xml
<?xml version="1.0"?>
<launch>
  <!-- load robot_description -->
  <param name="robot_description" command="$(find xacro)/xacro --inorder '$(find study_pkg)/urdf/example.urdf'" />
  <!-- publish /joint_states for robot_state_publisher node -->
  <node name="joint_state_publisher_gui" pkg="joint_state_publisher_gui" type="joint_state_publisher_gui" output="screen"/>
  <!-- publish tf from robot_description -->
  <node name="robot_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher" output="screen"/>
</launch>
```

> В другом окне терминала запустим `rviz` и настроим отображение: `Displays` > `Add` > `By display type` > `rviz` > `TF`, `RobotModel`. После настройки мы увидим наш объект и сможем поуправлять им.

> Дополнительно поиграйся с отображением окна `rviz` в вкладке `Displays` чтобы были видны все системы координат робота (подсказка - у модели робота можно менять прозрачность).

---

## Что нужно сделать?

> Напишите URDF для робота с 3 звеньями:
> 1. Базовое звено: цилиндр.
> 2. Среднее звено: параллелепипед.
> 3. Верхнее звено: цилиндр.
> 4. Два вращательных соединения между звеньями.

> Визуализируйте вашего робота в Rviz с помощью launch-файла.

---

> Большое задание - по чертежу создать urdf-описание манипулятора (он нам пригодится для последующей работы).

<p align="center">
    <img src=../assets/ros_topics/5_compas_task.png />
</p>

> Стрелки на чертеже обозначают вращательное движение звеньев.

> Подсказка - чтобы было проще - выпрями манипулятор вверх и задавай новые звенья относительно предыдущего звена.

---

## Вопросики

1. Что такое URDF и зачем он нужен?
2. Чем отличаются `<visual>` и `<collision>`?
3. Какие типы соединений вы знаете, и где их можно применить?

---

## С чем познакомились?

- Формат URDF для описания роботов.
- Основные элементы URDF: `<robot>`, `<link>`, `<joint>`.
- Работа с визуализацией робота в Rviz.

---

## Полезные ресурсы

- [Документация URDF](https://wiki.ros.org/urdf)
- [Описание XML элементов URDF](https://wiki.ros.org/urdf/XML)
- [Туториал по созданию модели робота](https://wiki.ros.org/urdf/Tutorials/Building%20a%20Visual%20Robot%20Model%20with%20URDF)
